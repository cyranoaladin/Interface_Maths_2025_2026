<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Second degré — Fiche élève (Mémo • Révisions • Méthode • Conseils)</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
      :root {
        /* Palette éducative */
        --bleu-confiance: #2563EB;
        --vert-reussite: #16A34A;
        --violet-creativite: #7C3AED;
        --orange-energie: #EA580C;
        --jaune-lumiere: #FCD34D;
        --rose-encouragement: #EC4899;
        
        /* Couleurs neutres */
        --gris-ardoise: #475569;
        --gris-clair: #94A3B8;
        --blanc-pur: #FFFFFF;
        --bleu-nuit: #0F172A;
        --gris-tres-clair: #F8FAFC;
        
        /* Gradients éducatifs */
        --gradient-apprentissage: linear-gradient(135deg, var(--bleu-confiance), var(--vert-reussite));
        --gradient-creativite: linear-gradient(135deg, var(--violet-creativite), var(--bleu-confiance));
        --gradient-energie: linear-gradient(135deg, var(--orange-energie), var(--jaune-lumiere));
        
        /* Ombres éducatives */
        --ombre-douce: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
        --ombre-moyenne: 0 10px 15px -3px rgba(37, 99, 235, 0.1);
        --ombre-forte: 0 20px 25px -5px rgba(37, 99, 235, 0.15);
      }

      [data-theme="light"] {
        --bg: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        --bg-card: rgba(255, 255, 255, 0.95);
        --bg-secondary: rgba(248, 250, 252, 0.8);
        --texte: var(--gris-ardoise);
        --texte-secondaire: var(--gris-clair);
        --bordure: rgba(226, 232, 240, 0.6);
        --bordure-forte: rgba(226, 232, 240, 1);
      }

      [data-theme="dark"] {
        --bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        --bg-card: rgba(30, 41, 59, 0.95);
        --bg-secondary: rgba(15, 23, 42, 0.8);
        --texte: #F1F5F9;
        --texte-secondaire: var(--gris-clair);
        --bordure: rgba(51, 65, 85, 0.6);
        --bordure-forte: rgba(51, 65, 85, 1);
      }

      /* Compatibilité avec l'ancien système */
      .light {
        --bg: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        --bg2: rgba(248, 250, 252, 0.8);
        --card: rgba(255, 255, 255, 0.95);
        --text: var(--gris-ardoise);
        --muted: var(--gris-clair);
        --primary: var(--bleu-confiance);
        --accent: var(--violet-creativite);
        --good: var(--vert-reussite);
        --bad: #DC2626;
        --border: rgba(226, 232, 240, 0.6);
        --shadow: var(--ombre-douce);
      }

      .dark {
        --bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        --bg2: rgba(15, 23, 42, 0.8);
        --card: rgba(30, 41, 59, 0.95);
        --text: #F1F5F9;
        --muted: var(--gris-clair);
        --primary: var(--bleu-confiance);
        --accent: var(--violet-creativite);
        --good: var(--vert-reussite);
        --bad: #DC2626;
        --border: rgba(51, 65, 85, 0.6);
        --shadow: var(--ombre-douce);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html, body {
        height: 100%;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
        transition: all 0.3s ease;
      }

      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--bleu-confiance);
        color: white;
        padding: 8px;
        text-decoration: none;
        border-radius: 4px;
        z-index: 1000;
      }

      .skip-link:focus {
        top: 6px;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 26px 18px 90px;
      }

      /* Header modernisé */
      header {
        position: sticky;
        top: 0;
        background: var(--card);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        z-index: 100;
        padding: 1rem 0;
        box-shadow: var(--shadow);
        border-radius: 0 0 16px 16px;
        margin-bottom: 2rem;
      }

      .toolbar {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }

      .header-info {
        flex: 1;
      }

      .header-info h1 {
        font-size: clamp(1.4rem, 2.2vw + 0.8rem, 2.4rem);
        margin: 8px 0;
        background: var(--gradient-apprentissage);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        color: white;
        background: var(--gradient-energie);
        padding: 6px 12px;
        border-radius: 20px;
        margin-left: 12px;
        font-weight: 600;
      }

      .muted {
        color: var(--muted);
        font-size: 0.875rem;
        margin: 4px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 10px 16px;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: var(--shadow);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        text-decoration: none;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--ombre-moyenne);
        border-color: var(--primary);
      }

      /* Cards modernisées */
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 24px;
        box-shadow: var(--shadow);
        margin-bottom: 24px;
        transition: all 0.3s ease;
      }

      .card:hover {
        box-shadow: var(--ombre-moyenne);
        transform: translateY(-2px);
      }

      /* Titres et sections */
      h1 {
        font-size: clamp(1.4rem, 2.2vw + 0.8rem, 2.4rem);
        margin: 8px 0;
      }

      h2 {
        font-size: 1.5rem;
        margin: 0.2rem 0 1rem;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      h2::before {
        content: '';
        width: 4px;
        height: 24px;
        background: var(--gradient-apprentissage);
        border-radius: 2px;
      }

      h3 {
        font-size: 1.2rem;
        margin: 0.2rem 0 0.8rem;
        color: var(--violet-creativite);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Grilles et layouts */
      .grid {
        display: grid;
        gap: 24px;
      }

      .grid2 {
        grid-template-columns: repeat(2, 1fr);
      }

      @media (max-width: 920px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }

      /* Pills et éléments spéciaux */
      .pill {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        background: var(--bg2);
        padding: 12px 16px;
        border-radius: 25px;
        border: 1px solid var(--border);
        margin-bottom: 16px;
        font-weight: 600;
        color: var(--violet-creativite);
      }

      /* Details et accordéons */
      details {
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px 20px;
        margin: 16px 0;
        transition: all 0.3s ease;
      }

      details:hover {
        box-shadow: var(--ombre-douce);
      }

      details[open] {
        background: var(--card);
        box-shadow: var(--ombre-douce);
      }

      summary {
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 0;
        color: var(--violet-creativite);
      }

      summary::before {
        content: '';
        width: 24px;
        height: 24px;
        background: var(--gradient-creativite);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      details[open] summary::before {
        background: var(--gradient-apprentissage);
      }

      /* Listes */
      ul {
        margin: 0 0 0 24px;
        line-height: 1.8;
      }

      ol {
        margin: 0 0 0 24px;
        line-height: 1.8;
      }

      li {
        margin: 8px 0;
      }

      /* Inputs et formulaires */
      .input {
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        color: var(--text);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
        transition: all 0.2s ease;
      }

      .input:focus {
        outline: 2px solid var(--primary);
        border-color: var(--primary);
      }

      label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 8px 12px 8px 0;
        font-weight: 600;
      }

      /* Résultats */
      .result {
        background: var(--bg2);
        border: 1px dashed var(--border);
        border-radius: 12px;
        padding: 12px 16px;
        margin-top: 12px;
        transition: all 0.3s ease;
      }

      .ok {
        background: rgba(22, 163, 74, 0.1);
        border: 1px solid rgba(22, 163, 74, 0.3);
        color: var(--vert-reussite);
      }

      .bad {
        background: rgba(220, 38, 38, 0.1);
        border: 1px solid rgba(220, 38, 38, 0.3);
        color: #DC2626;
      }

      /* Dividers */
      .hr {
        height: 2px;
        background: var(--gradient-apprentissage);
        border-radius: 1px;
        margin: 20px 0;
        opacity: 0.3;
      }

      /* Footer flottant */
      .sticky-footer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 50;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 16px 12px 60px;
        }
        
        .toolbar {
          flex-direction: column;
          align-items: stretch;
          gap: 16px;
        }
        
        .buttons {
          justify-content: center;
        }
        
        .grid {
          grid-template-columns: 1fr;
        }
      }

      /* Animations */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-in {
        animation: slideInUp 0.6s ease-out;
      }

      /* Print styles */
      @media print {
        .buttons, .sticky-footer {
          display: none !important;
        }
        .grid {
          grid-template-columns: 1fr !important;
        }
        details {
          display: block;
        }
        details > summary {
          display: none;
        }
        details > * {
          display: block;
        }
      }

      /* Couleurs des icônes */
      .icone-bleue { color: var(--bleu-confiance); }
      .icone-verte { color: var(--vert-reussite); }
      .icone-violette { color: var(--violet-creativite); }
      .icone-orange { color: var(--orange-energie); }
      .icone-jaune { color: var(--jaune-lumiere); }
      .icone-rose { color: var(--rose-encouragement); }

      /* Styles spécifiques pour les quiz */
      .quiz-card {
        border-left: 4px solid var(--violet-creativite);
        background: linear-gradient(90deg, transparent, rgba(124, 58, 237, 0.05));
      }

      .quiz-card h3 {
        color: var(--violet-creativite);
        margin-bottom: 16px;
      }

      .quiz-inputs {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 16px;
      }

      .quiz-inputs label {
        background: var(--bg2);
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
      }
    </style>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["$", "$"], ["\\(", "\\)"]],
          displayMath: [["$$", "$$"], ["\\[", "\\]"]],
          macros: {
            N: "\\mathbb{N}",
            Z: "\\mathbb{Z}",
            Q: "\\mathbb{Q}",
            R: "\\mathbb{R}",
            pp: "\\mathbb{P}"
          }
        },
        svg: { fontCache: 'global' }
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  </head>
  <body class="light">
    <a class="skip-link" href="#main">Aller au contenu</a>
    <div class="container">
      <header>
        <div class="toolbar">
          <div class="header-info">
            <h1>
              <i data-lucide="bookmark" class="icone-violette" style="width: 32px; height: 32px;"></i>
              Second degré — Fiche élève
              <span class="badge">
                <i data-lucide="zap" style="width: 16px; height: 16px;"></i>
                Mémo • Révisions • Méthode • Conseils
              </span>
            </h1>
            <p class="muted">
              <i data-lucide="info" class="icone-orange" style="width: 16px; height: 16px;"></i>
              À lire avant un contrôle: formules clés, méthodes pas à pas, pièges et mini‑tests rapides.
            </p>
          </div>
          <div class="buttons">
            <button class="btn" id="themeBtn">
              <i data-lucide="moon" id="theme-icon" style="width: 18px; height: 18px;"></i>
              <span>Thème</span>
            </button>
            <button class="btn" id="retypesetBtn">
              <i data-lucide="refresh-cw" style="width: 18px; height: 18px;"></i>
              <span>LaTeX</span>
            </button>
            <button class="btn" id="printBtn">
              <i data-lucide="printer" style="width: 18px; height: 18px;"></i>
              <span>Imprimer</span>
            </button>
          </div>
        </div>
      </header>

      <main id="main">
        <section class="card animate-in" id="memo">
          <h2>
            <i data-lucide="brain" class="icone-bleue" style="width: 28px; height: 28px;"></i>
            1) Mémo — Formules indispensables
          </h2>
          <div class="grid">
            <div class="pill">
              <i data-lucide="function-square" class="icone-violette" style="width: 20px; height: 20px;"></i>
              Trinôme $f(x)=ax^2+bx+c$ avec $a\ne0$
            </div>
            <ul>
              <li><strong>Forme canonique:</strong> $f(x)=a(x-\alpha)^2+\beta$ où $\alpha=-\dfrac{b}{2a}$ et $\beta=f(\alpha)=c-\dfrac{b^2}{4a}$.</li>
              <li><strong>Discriminant:</strong> $\Delta=b^2-4ac$.
                <ul>
                  <li>$\Delta>0$: racines $\dfrac{-b\pm\sqrt{\Delta}}{2a}$, factorisation $a(x-x_1)(x-x_2)$.</li>
                  <li>$\Delta=0$: racine double $-\dfrac{b}{2a}$, factorisation $a(x-x_0)^2$.</li>
                  <li>$\Delta<0$: pas de racine réelle; signe de $f$ = signe de $a$.</li>
                </ul>
              </li>
              <li><strong>Somme/produit</strong> (si racines réelles $x_1,x_2$): $S=x_1+x_2=-\dfrac{b}{a}$, $P=x_1x_2=\dfrac{c}{a}$.</li>
              <li><strong>Signe</strong> (notation française): $a>0 \Rightarrow f\ge0$ sur $]-\infty;x_1]\cup[x_2;+\infty[$ et $f\le0$ sur $[x_1;x_2]$ (règle inversée si $a<0$).</li>
            </ul>
          </div>
        </section>

        <section class="card animate-in" id="methodes">
          <h2>
            <i data-lucide="compass" class="icone-verte" style="width: 28px; height: 28px;"></i>
            2) Méthodologie — Pas à pas
          </h2>
          
          <details open>
            <summary>
              <i data-lucide="target" style="width: 20px; height: 20px;"></i>
              <strong>Mettre sous forme canonique</strong>
            </summary>
            <ol>
              <li>Calculer $\alpha=-\dfrac{b}{2a}$ puis $\beta=f(\alpha)$.</li>
              <li>Écrire $f(x)=a(x-\alpha)^2+\beta$.</li>
              <li>Interpréter: $S(\alpha,\beta)$ est le sommet; minimum si $a>0$, maximum si $a<0$.</li>
            </ol>
          </details>
          
          <details>
            <summary>
              <i data-lucide="calculator" style="width: 20px; height: 20px;"></i>
              <strong>Résoudre $ax^2+bx+c=0$</strong>
            </summary>
            <ol>
              <li>Calculer $\Delta=b^2-4ac$.</li>
              <li>$\Delta<0$: pas de solution réelle. $\Delta=0$: $x=-\dfrac{b}{2a}$. $\Delta>0$: $x_{1,2}=\dfrac{-b\pm\sqrt{\Delta}}{2a}$.</li>
            </ol>
          </details>
          
          <details>
            <summary>
              <i data-lucide="trending-up" style="width: 20px; height: 20px;"></i>
              <strong>Signe de $f$</strong>
            </summary>
            <ol>
              <li>Si $\Delta<0$: signe de $f$ = signe de $a$ sur $\R$.</li>
              <li>Si $\Delta\ge0$: placer les racines sur l'axe et appliquer la règle « signe de $a$ à l'extérieur, signe contraire entre ».</li>
            </ol>
          </details>
        </section>

        <section class="card animate-in" id="quick">
          <h2>
            <i data-lucide="zap" class="icone-orange" style="width: 28px; height: 28px;"></i>
            3) Révisions express — 10 minutes
          </h2>
          <div class="grid grid2">
            <div class="card quiz-card">
              <h3>
                <i data-lucide="search" class="icone-violette" style="width: 24px; height: 24px;"></i>
                Δ et racines
              </h3>
              <div class="quiz-inputs">
                <label>a <input id="qa" class="input" type="number" step="any" value="1" style="width:120px"></label>
                <label>b <input id="qb" class="input" type="number" step="any" value="-2" style="width:120px"></label>
                <label>c <input id="qc" class="input" type="number" step="any" value="-3" style="width:120px"></label>
              </div>
              <button class="btn" id="btnQ1">
                <i data-lucide="check-circle" style="width: 16px; height: 16px;"></i>
                Vérifier
              </button>
              <div id="q1out" class="result"></div>
            </div>
            
            <div class="card quiz-card">
              <h3>
                <i data-lucide="square" class="icone-violette" style="width: 24px; height: 24px;"></i>
                Forme canonique
              </h3>
              <div class="quiz-inputs">
                <label>a <input id="ca" class="input" type="number" step="any" value="2" style="width:120px"></label>
                <label>b <input id="cb" class="input" type="number" step="any" value="-20" style="width:120px"></label>
                <label>c <input id="cc" class="input" type="number" step="any" value="10" style="width:120px"></label>
              </div>
              <button class="btn" id="btnQ2">
                <i data-lucide="check-circle" style="width: 16px; height: 16px;"></i>
                Vérifier
              </button>
              <div id="q2out" class="result"></div>
            </div>
            
            <div class="card quiz-card">
              <h3>
                <i data-lucide="bar-chart" class="icone-violette" style="width: 24px; height: 24px;"></i>
                Signe (notation française)
              </h3>
              <div class="quiz-inputs">
                <label>a <input id="sa" class="input" type="number" step="any" value="1" style="width:120px"></label>
                <label>b <input id="sb" class="input" type="number" step="any" value="-5" style="width:120px"></label>
                <label>c <input id="sc" class="input" type="number" step="any" value="6" style="width:120px"></label>
              </div>
              <button class="btn" id="btnQ3">
                <i data-lucide="check-circle" style="width: 16px; height: 16px;"></i>
                Vérifier
              </button>
              <div id="q3out" class="result"></div>
            </div>
            
            <div class="card quiz-card">
              <h3>
                <i data-lucide="puzzle" class="icone-violette" style="width: 24px; height: 24px;"></i>
                Reconstruire depuis S et P
              </h3>
              <div class="quiz-inputs">
                <label>S <input id="rs" class="input" type="number" step="any" value="5" style="width:120px"></label>
                <label>P <input id="rp" class="input" type="number" step="any" value="6" style="width:120px"></label>
              </div>
              <button class="btn" id="btnQ4">
                <i data-lucide="play" style="width: 16px; height: 16px;"></i>
                Construire
              </button>
              <div id="q4out" class="result"></div>
            </div>
          </div>
        </section>

        <section class="card animate-in" id="conseils">
          <h2>
            <i data-lucide="lightbulb" class="icone-jaune" style="width: 28px; height: 28px;"></i>
            4) Conseils & erreurs fréquentes
          </h2>
          
          <details open>
            <summary>
              <i data-lucide="alert-triangle" style="width: 20px; height: 20px;"></i>
              <strong>Pièges à éviter</strong>
            </summary>
            <ul>
              <li>Oublier $a\ne0$ (il faut tester avant toute division par $a$).</li>
              <li>Confondre $-\dfrac{b}{2a}$ et $\dfrac{-b}{2a}$ (c'est la même chose, mais pas $\dfrac{-b}{2}\,a$).</li>
              <li>Appliquer la règle de signe sans trier $x_1\le x_2$.</li>
              <li>Mauvaise notation des intervalles: utiliser $]-\infty;\,\cdot]$ et $[\cdot;\,+\infty[$.</li>
            </ul>
          </details>
          
          <details>
            <summary>
              <i data-lucide="graduation-cap" style="width: 20px; height: 20px;"></i>
              <strong>Avant un contrôle</strong>
            </summary>
            <ul>
              <li>Recopier la fiche Mémo sur une feuille A4 et la relire 2 fois.</li>
              <li>Faire 3 équations et 3 inéquations en autonomie (temps limité).</li>
              <li>Vérifier ses réponses avec l'outil du cours (Δ, racines, signe).</li>
            </ul>
          </details>
        </section>

        <section class="card animate-in" id="liens">
          <h2>
            <i data-lucide="external-link" class="icone-rose" style="width: 28px; height: 28px;"></i>
            5) Aller plus loin
          </h2>
          <ul>
            <li>
              <i data-lucide="book-open" class="icone-bleue" style="width: 16px; height: 16px; margin-right: 8px;"></i>
              Relire le cours complet: <a href="/EDS_premiere/Second_Degre/cours_second_degre.html" style="color: var(--bleu-confiance); text-decoration: none; font-weight: 600;">Second degré — Cours complet</a>
            </li>
          </ul>
        </section>
      </main>

      <div class="sticky-footer">
        <button class="btn" onclick="scrollTo(0,0)">
          <i data-lucide="arrow-up" style="width: 18px; height: 18px;"></i>
          <span>Haut</span>
        </button>
      </div>
    </div>

    <script>
      // Initialiser les icônes Lucide
      lucide.createIcons();

      // Fonctions utilitaires
      const $ = (q) => document.querySelector(q);
      
      function fmt(x) {
        if (!isFinite(x)) return String(x);
        const s = Number(x).toFixed(6);
        return s.replace(/\.0+$/, '').replace(/(\.[0-9]*[1-9])0+$/, '$1');
      }
      
      function intervalsFR(a, b, c) {
        const D = b * b - 4 * a * c;
        if (D < 0) {
          return a > 0 ? "$]-\\infty;+\\infty[$" : "∅";
        }
        if (D === 0) {
          const x0 = -b / (2 * a);
          return a > 0 ? `$]-\\infty;${fmt(x0)}]\\cup[${fmt(x0)};+\\infty[$` : `∅`;
        }
        const r1 = (-b - Math.sqrt(D)) / (2 * a), r2 = (-b + Math.sqrt(D)) / (2 * a);
        const [x1, x2] = [Math.min(r1, r2), Math.max(r1, r2)];
        return a > 0 ? `$]-\\infty;${fmt(x1)}]\\cup[${fmt(x2)};+\\infty[$` : `$[${fmt(x1)};${fmt(x2)}]$`;
      }
      
      function canonical(a, b, c) {
        const alpha = -b / (2 * a);
        const beta = c - (b * b) / (4 * a);
        return { alpha, beta };
      }

      // Gestion du thème
      function toggleTheme() {
        const body = document.body;
        const currentTheme = body.classList.contains('dark') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        const themeIcon = document.getElementById('theme-icon');
        
        body.className = newTheme;
        localStorage.setItem('theme-fiche-eleve', newTheme);
        
        // Changer l'icône
        themeIcon.setAttribute('data-lucide', newTheme === 'dark' ? 'sun' : 'moon');
        lucide.createIcons();
        MathJax.typesetPromise?.();
      }

      // Chargement du thème sauvegardé
      const savedTheme = localStorage.getItem('theme-fiche-eleve') || 'light';
      document.body.className = savedTheme;
      document.getElementById('theme-icon').setAttribute('data-lucide', savedTheme === 'dark' ? 'sun' : 'moon');

      // Event listeners
      document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        
        // Boutons principaux
        $('#themeBtn')?.addEventListener('click', toggleTheme);
        $('#retypesetBtn')?.addEventListener('click', () => MathJax.typesetPromise?.());
        $('#printBtn')?.addEventListener('click', () => window.print());

        // Quiz interactifs
        $('#btnQ1')?.addEventListener('click', () => {
          const a = parseFloat($('#qa').value), b = parseFloat($('#qb').value), c = parseFloat($('#qc').value);
          if (!(isFinite(a) && a !== 0 && isFinite(b) && isFinite(c))) {
            $('#q1out').innerHTML = '<div class="result bad">Entrer a non nul, b, c.</div>';
            return;
          }
          const D = b * b - 4 * a * c;
          let msg = `$\\Delta=${fmt(D)}$`;
          if (D < 0) {
            msg += ` — aucune racine réelle`;
          } else if (D === 0) {
            msg += ` — racine double $x=${fmt(-b / (2 * a))}$`;
          } else {
            const x1 = (-b - Math.sqrt(D)) / (2 * a), x2 = (-b + Math.sqrt(D)) / (2 * a);
            msg += ` — racines $x=${fmt(x1)}, ${fmt(x2)}$`;
          }
          $('#q1out').innerHTML = `<div class="result ok">${msg}</div>`;
          MathJax.typesetPromise?.();
        });

        $('#btnQ2')?.addEventListener('click', () => {
          const a = parseFloat($('#ca').value), b = parseFloat($('#cb').value), c = parseFloat($('#cc').value);
          if (!(isFinite(a) && a !== 0 && isFinite(b) && isFinite(c))) {
            $('#q2out').innerHTML = '<div class="result bad">Entrer a non nul, b, c.</div>';
            return;
          }
          const { alpha, beta } = canonical(a, b, c);
          $('#q2out').innerHTML = `<div class="result ok">$f(x)=${fmt(a)}(x-${fmt(alpha)})^2+${fmt(beta)}$ ; sommet $S(${fmt(alpha)},${fmt(beta)})$</div>`;
          MathJax.typesetPromise?.();
        });

        $('#btnQ3')?.addEventListener('click', () => {
          const a = parseFloat($('#sa').value), b = parseFloat($('#sb').value), c = parseFloat($('#sc').value);
          if (!(isFinite(a) && a !== 0 && isFinite(b) && isFinite(c))) {
            $('#q3out').innerHTML = '<div class="result bad">Entrer a non nul, b, c.</div>';
            return;
          }
          const z = intervalsFR(a, b, c);
          $('#q3out').innerHTML = `<div class="result ok">$f(x) \\ge 0$ sur ${z}</div>`;
          MathJax.typesetPromise?.();
        });

        $('#btnQ4')?.addEventListener('click', () => {
          const S = parseFloat($('#rs').value), P = parseFloat($('#rp').value);
          if (!(isFinite(S) && isFinite(P))) {
            $('#q4out').innerHTML = '<div class="result bad">Entrer S et P.</div>';
            return;
          }
          $('#q4out').innerHTML = `<div class="result ok">Trinôme monique: $x^2-${fmt(S)}x+${fmt(P)}$</div>`;
          MathJax.typesetPromise?.();
        });

        // Animation d'entrée progressive
        const cards = document.querySelectorAll('.animate-in');
        cards.forEach((card, index) => {
          setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, index * 200);
        });
      });
    </script>
  </body>
</html>
