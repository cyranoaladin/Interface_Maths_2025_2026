<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arithm√©tique - Partie 1 : Divisibilit√© et congruences</title>
<style>
  :root{--bg:#0b1020;--bg2:#11162a;--card:#151b34;--text:#eef2ff;--muted:#a2b0d6;--primary:#6aa6ff;--accent:#22d3ee;--good:#0b3d23;--bad:#65121f;--border:#28314f;--shadow:0 10px 30px rgba(0,0,0,.25)}
  .light{--bg:#f6f7fb;--bg2:#eef0f8;--card:#fff;--text:#0f172a;--muted:#4b5563;--primary:#3b82f6;--accent:#06b6d4;--good:#059669;--bad:#b91c1c;--border:#e5e7eb;--shadow:0 10px 30px rgba(2,6,23,.06)}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .container{max-width:1200px;margin:0 auto;padding:26px 18px 90px}
  header{position:sticky;top:0;background:linear-gradient(180deg,var(--bg) 80%,#0000);backdrop-filter:saturate(1.2);z-index:20;padding-bottom:8px}
  .toolbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .buttons{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:var(--card);border:1px solid var(--border);color:var(--text);padding:9px 14px;border-radius:14px;cursor:pointer;box-shadow:var(--shadow);display:inline-flex;align-items:center;gap:8px}
  .btn:hover{filter:brightness(1.05)}
  .badge{display:inline-block;font-size:.8rem;color:white;background:linear-gradient(135deg,var(--accent),#7dd3fc);padding:2px 10px;border-radius:999px;margin-left:6px}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:18px}
  .cols-2{grid-template-columns:1.05fr .95fr}
  @media (max-width:980px){.cols-2{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
  h1{font-size:clamp(1.4rem,2.2vw + .8rem,2.4rem);margin:8px 0}
  h2{font-size:1.45rem;margin:.2rem 0 .6rem}
  h3{font-size:1.1rem;margin:.2rem 0}
  .pill{display:inline-flex;gap:8px;align-items:center;background:var(--bg2);padding:8px 12px;border-radius:999px;border:1px solid var(--border)}
  .section{scroll-margin-top:90px}
  details{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:10px 12px;margin:.6rem 0}
  summary{cursor:pointer;font-weight:600}
  .step{display:flex;gap:12px;align-items:flex-start;border-left:3px solid #30406e;padding:10px 12px;margin:10px 0;background:linear-gradient(90deg,#0000,rgba(99,102,241,.08))}
  .step .n{flex:0 0 26px;height:26px;display:grid;place-items:center;border-radius:8px;background:#334155;color:#fff;font-weight:700}
  .result{background:var(--bg2);border:1px dashed #3b4a77;border-radius:10px;padding:8px 10px;margin-top:8px}
  .ok{background:var(--good);border-color:#0f5132;color:#fff}
  .err{background:var(--bad);border-color:#842029;color:#fff}
  .input{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:9px 10px;color:var(--text)}
  .input:focus{outline:2px solid var(--primary)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .hr{height:1px;background:linear-gradient(90deg,#0000,#39508f,#0000);margin:12px 0}
  .board *{font-size:1.12em}
  .toolbar small{display:block}
  .control-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .tag{font-size:.78rem;color:#cbd5e1;background:#1f2937;border:1px solid #334155;padding:2px 8px;border-radius:999px}
  .sticky-footer{position:fixed;bottom:16px;right:16px;display:flex;flex-direction:column;gap:10px}
  .hidden{display:none}
  nav.card ol{margin:0 0 8px 18px}
  .btn:focus-visible, .input:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
</style>
<script>
  window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],macros:{N:"\\mathbb{N}",Z:"\\mathbb{Z}",Q:"\\mathbb{Q}",R:"\\mathbb{R}",div:"\\mid",ndiv:"\\nmid",pmod:"\\;\\mathrm{mod}\\;"}},svg:{fontCache:'global'}};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body class="light">
<div class="container">
  <header>
    <div class="toolbar">
      <div>
<h1>Arithm√©tique - Partie 1 : Divisibilit√© et congruences <span class="badge">Arithm√©tique : cours int√©gral + outils</span></h1>
        <p class="muted" style="margin:4px 0 0">Terminale ‚Äî Maths expertes</p>
        <small class="muted">Auteur : <strong>Alaeddine Ben Rhouma</strong> ‚Äî Lyc√©e Pierre Mend√®s France, Tunis ‚Ä¢ ¬© Propri√©t√© intellectuelle ‚Ä¢ Raccourcis : <kbd>Ctrl</kbd>+<kbd>B</kbd> (Tableau), <kbd>?</kbd> (Aide)</small>
      </div>
      <div class="buttons">
        <button class="btn" id="themeBtn">üåì Th√®me</button>
        <button class="btn" id="boardBtn">üñ•Ô∏è Tableau</button>
        <button class="btn" id="retypesetBtn">üîÑ LaTeX</button>
        <button class="btn" id="revealBtn">üß© R√©v√©lations</button>
        <button class="btn" id="printBtn">üñ®Ô∏è Imprimer</button>
      </div>
    </div>
  </header>

  <section class="grid cols-2">
    <nav class="card">
      <h2>Plan</h2><div class="hr"></div>
      <ol>
        <li><a href="#div">Divisibilit√© (P1‚ÜíP4)</a></li>
        <li><a href="#de">Division euclidienne + Lemme (P5)</a></li>
        <li><a href="#cong">Congruences (d√©f., P6‚ÄìP7)</a></li>
        <li><a href="#bank">Banque d‚Äôitems param√©trables</a></li>
        <li><a href="#timer">Chronom√®tre d‚Äôactivit√©</a></li>
        <li><a href="#exports">Exports des traces</a></li>
        <li><a href="#python">Encart Python (Euclide)</a></li>
        <li><a href="#tests">Auto‚Äëtests</a></li>
      </ol>
      <p class="muted">Les corrections et preuves sont masqu√©es par d√©faut (bouton ‚Äúüß© R√©v√©lations‚Äù).</p>
    </nav>
    <div class="card">
      <h2>Objectifs p√©dagogiques</h2>
      <ul>
        <li>D√©finir et utiliser la <strong>divisibilit√©</strong> dans $\mathbb{Z}$ et en d√©montrer les propri√©t√©s P1‚ÜíP4.</li>
        <li>Mettre en ≈ìuvre la <strong>division euclidienne</strong> et le <strong>lemme des restes</strong> pour raisonner par classes de restes.</li>
        <li>Introduire les <strong>congruences</strong> (P6‚ÄìP7) pour <strong>simplifier</strong> des calculs et prouver des propri√©t√©s.</li>
        <li>R√©soudre des <strong>√©quations lin√©aires modulaires</strong> $ax\equiv b\pmod  n$ via Euclide √©tendu et interpr√©ter les solutions.</li>
        <li>Comp√©tences : chercher, mod√©liser, raisonner/d√©montrer, calculer, communiquer.</li>
      </ul>
    </div>
  </section>

  <!-- 1. Divisibilit√© -->
  <section id="div" class="section card">
    <h2>1. Divisibilit√© dans $\Z$ ‚Äî d√©f., P1‚ÜíP4</h2>
    <p><strong>D√©finition.</strong> Soient $a,b\in\Z$ avec $b\ne0$. On dit que $b$ divise $a$ s‚Äôil existe $k\in\Z$ tel que $a=bk$. On dit aussi que $a$ est un multiple de $b$. <em>Rappel :</em> $0$ est multiple de tout entier mais ne divise aucun entier.</p>

    <details><summary>P1 ‚Äî inclusions d‚Äôensembles</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>Si $b\mid a$, alors $a\Z\subset b\Z$ et $D(b)\subset D(a)$.</div></div>
      <details><summary>Preuve pas √† pas</summary>
        <div class="step"><div class="n">1</div><div>Supposons $a=bk$. Soit $m\in\Z$. Tout multiple de $a$ s‚Äô√©crit $am=b(km)$ : c‚Äôest un multiple de $b$.</div></div>
        <div class="step"><div class="n">2</div><div>Si $d\in D(b)$, il existe $x\in\Z$ tel que $b=dx$. Et si $b\mid a$, il existe $y\in\Z$ tel que $a=by=d(xy)$ : donc $d\mid a$ et $d\in D(a)$.</div></div>
      </details>
    <details><summary>Preuve r√©dig√©e</summary>
      <p>Supposons $b\mid a$. Alors il existe $k\in\Z$ tel que $a=bk$.
      Pour tout $m\in\Z$, tout multiple de $a$ s‚Äô√©crit $am=b(km)$, donc $a\Z\subset b\Z$.
      D‚Äôautre part, si $d\in D(b)$, il existe $x\in\Z$ tel que $b=dx$. Comme $b\mid a$, il existe $y\in\Z$ tel que $a=by=d(xy)$ ; ainsi $d\mid a$ et $D(b)\subset D(a)$.</p>
    </details>
    <details><summary>Exemples (du poly)</summary>
        <div class="step"><div class="n">E1</div><div>Les multiples de $24$ sont aussi des multiples de $3$ : $24\Z\subset3\Z$.</div></div>
        <div class="step"><div class="n">E2</div><div>Les diviseurs de $12$ sont des diviseurs de $24$ : $D(12)=\{-12,-6,-4,-3,-2,-1,1,2,3,4,6,12\}$ et $D(24)=\{\,?\,\}$. <br>Compl√©ter ci‚Äëdessous puis v√©rifier $D(12)\subset D(24)$.</div></div>
        <div class="result">
          <label class="muted mono">$D(24)$</label>
          <input class="input mono" id="qD24" size="46" placeholder="{-24,-12,-8,-6,-4,-3,-2,-1,1,2,3,4,6,8,12,24}">
          <button class="btn" onclick="checkSet('qD24',[ -24,-12,-8,-6,-4,-3,-2,-1,1,2,3,4,6,8,12,24 ])">V√©rifier</button>
          <span id="qD24r" aria-live="polite"></span>
        </div>
      </details>
    </details>

    <details><summary>P2 ‚Äî gestion des signes</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>$b\mid a \iff -b\mid a \iff b\mid -a \iff -b\mid -a$.</div></div>
      <details><summary>Preuve pas √† pas</summary>
        <div class="step"><div class="n">1</div><div>De $a=bk$ on tire $a=(-b)(-k)$, donc $-b\mid a$.</div></div>
        <div class="step"><div class="n">2</div><div>De $a=bk$ on tire $-a=b(-k)$, donc $b\mid -a$.</div></div>
      </details>
      <details><summary>Preuve r√©dig√©e</summary>
        <p>Des √©galit√©s $a=bk \iff a=(-b)(-k)$ et $a=bk \iff -a=b(-k)$, on d√©duit les √©quivalences $b\mid a \iff -b\mid a \iff b\mid -a \iff -b\mid -a$.</p>
      </details>
    </details>
    <p class="muted">Cons√©quence¬†: $a$ et $-a$ ont les m√™mes diviseurs dans $\Z$. On pourra souvent restreindre l‚Äô√©tude √† $\N$.</p>

    <details><summary>P3 ‚Äî nombre fini de diviseurs</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>Tout $n\in\Z^*$ poss√®de un nombre fini de diviseurs compris entre $-n$ et $n$.</div></div>
      <details><summary>Preuve pas √† pas</summary>
        <div class="step"><div class="n">1</div><div>Si $d\mid n$ alors $|d|\le |n|$.</div></div>
        <div class="step"><div class="n">2</div><div>Il n‚Äôexiste qu‚Äôun nombre fini d‚Äôentiers dans l‚Äôintervalle $[-|n|,|n|]$.</div></div>
      </details>
      <details><summary>Preuve r√©dig√©e</summary>
        <p>Soit $n\in\Z^*$. Si $d\mid n$, alors $n=dk$ pour un certain $k\in\Z$, d‚Äôo√π $|d|\le |n|$.
        Comme l‚Äôintervalle $[-|n|,|n|]$ ne contient qu‚Äôun nombre fini d‚Äôentiers, $n$ n‚Äôa qu‚Äôun nombre fini de diviseurs.</p>
      </details>
    </details>
    <p class="muted">Remarque¬†: le nombre de multiples d‚Äôun entier non nul est infini.</p>

    <details><summary>P4 ‚Äî transitivit√© et combinaisons lin√©aires</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>(i) $a\mid b$ et $b\mid c$ $\Rightarrow a\mid c$. (ii) Si $a\mid b$ et $a\mid c$ alors $a\mid (ub+vc)$ pour tous $u,v\in\Z$.</div></div>
      <details><summary>Preuve pas √† pas</summary>
        <div class="step"><div class="n">1</div><div>(i) $b=ak_1$, $c=bk_2$ $\Rightarrow$ $c=a(k_1k_2)$.</div></div>
        <div class="step"><div class="n">2</div><div>(ii) $b=a\beta$, $c=a\gamma$ $\Rightarrow$ $ub+vc=a(u\beta+v\gamma)$ donc $a\mid(ub+vc)$.</div></div>
      </details>
      <details><summary>Preuve r√©dig√©e</summary>
        <p>(i) Si $a\mid b$ et $b\mid c$, il existe $k_1,k_2\in\Z$ tels que $b=ak_1$ et $c=bk_2$ ; ainsi $c=a(k_1k_2)$ et $a\mid c$.
        (ii) Si $a\mid b$ et $a\mid c$, il existe $\beta,\gamma\in\Z$ tels que $b=a\beta$ et $c=a\gamma$ ;
        pour tous $u,v\in\Z$, on a $ub+vc=a(u\beta+v\gamma)$, donc $a\mid(ub+vc)$.</p>
      </details>
      <details><summary>Exemple (du poly)</summary>
        <div class="step"><div class="n">Ex</div><div>Si $a$ divise deux entiers cons√©cutifs, alors $a=\pm1$. <em>Id√©e :</em> $a\mid (n)$ et $a\mid (n+1)$ $\Rightarrow$ $a\mid ((n+1)-n)=1$.</div></div>
      </details>
    </details>

    <details>
      <summary>Exemples & mini‚Äëquiz (trous du poly)</summary>
      <div class="step"><div class="n">E1</div><div>Compl√©ter : ¬´ 4 divise 24 car $24 = 4\	imes 6$ ; ‚àí4 divise aussi 24 car <input class="input mono" id="q1" size="16" placeholder="24 = -4 √ó -6">. ¬ª <button class="btn" onclick="checkText('q1','24 = -4√ó-6')">V√©rifier</button> <span id="q1r" class="muted" aria-live="polite">Formats accept√©s¬†: espaces libres, `√ó`, `x` ou `*`.</span></div></div>
      <div class="step"><div class="n">E2</div><div>D√©terminer les entiers $n$ tels que $2n+1$ divise $n+13$. <details><summary>Correction d√©taill√©e</summary><div>Si $2n+1\mid n+13$, alors par combinaison lin√©aire on a $2(n+13)-(2n+1)=25$, donc $2n+1\mid 25$. Comme $2n+1$ est impair, on obtient $2n+1\in\{\pm1,\pm5,\pm25\}$. On r√©sout $2n+1=d$ pour chaque cas et on trouve $n\in\{0,-1,2,-3,12,-13\}$. V√©rification¬†: par exemple pour $n=12$, $2n+1=25\mid 25$ ; pour $n=-3$, $2n+1=-5\mid 10$. Ainsi les solutions sont $n\in\{-13,-3,-1,0,2,12\}$.</div></details></div></div>
    </details>
  </section>

  <!-- 2. Division euclidienne + Lemme -->
  <section id="de" class="section card">
    <h2>2. Division euclidienne ‚Äî Th√©or√®me & P5 (Lemme des restes)</h2>
    <p><strong>Th√©or√®me.</strong> Pour $a\in\Z$, $b\in\N^*$, il existe un unique $(q,r)\in\Z^2$ tel que $a=bq+r$ avec $0\le r<b$. $q$ est le <em>quotient</em> et $r$ le <em>reste</em>.</p>
    <details open><summary>Exemple guid√© (114 √∑ 8)</summary>
      <div class="control-row"><label class="muted" for="dea">$a$</label><input id="dea" class="input" type="number" value="114" aria-describedby="deOut"><label class="muted" for="deb">$b$</label><input id="deb" class="input" type="number" value="8" aria-describedby="deOut"><button class="btn" onclick="doDiv()">Calculer</button></div>
      <div id="deOut" class="result" role="status" aria-live="polite"></div><div id="deSteps" aria-live="polite"></div>
    </details>
    <details>
      <summary>Remarques et contre‚Äëexemples (trous du poly)</summary>
      <div class="step"><div class="n">R1</div><div>Compl√©ter : ¬´ Dans la division par $b$, il y a <input class="input mono" id="q3" size="3" placeholder="b"> restes possibles : $0,1,\\dots,b-1$. ¬ª <button class="btn" onclick="checkText('q3','b')">V√©rifier</button> <span id="q3r" aria-live="polite"></span></div></div>
      <div class="step"><div class="n">R2</div><div>Compl√©ter : ¬´ $56 = 17\	imes 3 + 5 = 17\	imes 2 + 22$ mais la seconde n‚Äôest <strong>pas</strong> euclidienne car <input class="input mono" id="q4" size="10" placeholder="22 > 17">. ¬ª <button class="btn" onclick="checkText('q4','22 > 17')">V√©rifier</button> <span id="q4r" class="muted" aria-live="polite">Format accept√©¬†: espaces libres autour de `>`.</span></div></div>
    </details>
    <details open><summary>Propri√©t√© P5 ‚Äî Lemme des restes</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>Pour tout $b\ge2$, tout entier s‚Äô√©crit sous l‚Äôune des formes $bq,\,bq+1,\,\dots,\,bq+(b-1)$.</div></div>
      <div class="step"><div class="n">Exercice</div><div>Montrer que $n^2+1$ n‚Äôest jamais divisible par $3$. <button class="btn" onclick="toggle('exP5')">Indice / solution</button></div></div>
      <div id="exP5" class="result hidden">
        <details><summary>Indice</summary>
          Consid√©rer $n$ modulo $3$.
        </details>
        <details><summary>Correction d√©taill√©e</summary>
          On a $n\equiv 0,1,2 \pmod {3}$. Donc $n^2 \equiv 0,1,1$ et $n^2+1\equiv 1,2,2$ : jamais $0$. Ainsi $3\nmid (n^2+1)$.
        </details>
      </div>
    </details>
    <details><summary>Exercice ‚Äî Produit de trois entiers cons√©cutifs divisible par 3</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>Montrer que, pour tout entier $n$, le produit $n(n+1)(n-1)$ est divisible par $3$.</div></div>
      <details><summary>Correction</summary>
        <div class="step"><div class="n">1</div><div>Raisonnement modulaire¬†: modulo $3$, tout entier est congru √† $0,1$ ou $2$. Parmi trois entiers cons√©cutifs $n-1,n,n+1$, il y en a toujours un congru √† $0$ modulo $3$.</div></div>
        <div class="step"><div class="n">2</div><div>Donc le produit est un multiple de $3$.</div></div>
      </details>
    </details>
  </section>

  <!-- 3. Congruences -->
  <section id="cong" class="section card">
    <h2>3. Congruences ‚Äî d√©f., P6 (reste) & P7 (r√®gles)</h2>
    <details><summary>Pr√©ambule ‚Äî Jeu ¬´¬†course √† 20¬†¬ª (mod 4)</summary>
      <div class="step"><div class="n">R√®gle</div><div>Deux joueurs ajoutent √† tour de r√¥le 1, 2 ou 3 √† un total initialement nul. Celui qui annonce 20 gagne.</div></div>
      <div class="step"><div class="n">Id√©e</div><div>Viser les paliers $4,8,12,16,20$ (nombres $\equiv0\pmod 4$). L‚Äôobjectif est de conserver l‚Äôinvariant ¬´¬†apr√®s mon tour, le total est $\equiv 0 \pmod 4$¬†¬ª.</div></div>
      <div class="step"><div class="n">Strat√©gie</div><div>Comme $20\equiv 0\pmod  4$, le <strong>deuxi√®me</strong> joueur poss√®de une strat√©gie gagnante¬†: √† tout coup $c\in\{1,2,3\}$ du premier, r√©pondre $4-c$ pour que la paire de coups vaille $4$ et atteindre successivement $4,8,12,16,20$.</div></div>
      <details><summary>G√©n√©ralisation</summary>
        <p>Avec des coups autoris√©s $1,2,\dots,m$, les paliers sont les multiples de $m+1$. Si la cible $T$ v√©rifie $T\equiv r\pmod  {m+1}$ avec $r\ne 0$, alors le premier joueur gagne en jouant $r$ au premier coup puis en ¬´¬†compl√©tant √† $m+1$¬†¬ª. Si $T\equiv 0\pmod  {m+1}$, le second joueur a une strat√©gie gagnante.</p>
      </details>
      <details><summary>Justification modulaire</summary>
        <p>Le coup adverse ajoute $c\in\{1,2,3\}$. R√©pondez $4-c$¬†: la somme des deux coups vaut 4. On poursuit ainsi jusqu‚Äô√† $20=4	imes 5$.</p>
      </details>
    </details>
    <p><strong>D√©finition.</strong> Pour $a,b\in\Z$, $n\in\N^*$, $a\equiv b\pmod{n}$ si $n\mid(a-b)$.</p>
    <details open><summary>P6 ‚Äî ¬´ m√™me reste ¬ª $\Leftrightarrow$ congruence</summary>
      <div class="step"><div class="n">‚áê</div><div>Si $a=qn+r$ et $b=pn+r$ alors $a-b=(q-p)n$ : $n\mid(a-b)$.</div></div>
      <div class="step"><div class="n">‚áí</div><div>Si $a-b=kn$ alors $a=b+kn$ : $a$ et $b$ ont le m√™me reste mod $n$.</div></div>
    <details><summary>Preuve r√©dig√©e</summary>
      <p>√âcrire $a=qn+r$ et $b=pn+s$ avec $0\le r,s < n$. Si $r=s$ alors $a-b=(q-p)n$ et $n\mid(a-b)$. R√©ciproquement, si $n\mid(a-b)$, il existe $k\in\Z$ tel que $a=b+kn$.
      Les divisions euclidiennes de $a$ et $b$ par $n$ co√Øncident modulo $n$, donc les restes sont √©gaux.</p>
    </details>
    <details><summary>P7 ‚Äî Compatibilit√©s & limites</summary>
      <ol>
        <li>Si $a\equiv b\pmod  n$ alors, pour tout $c\in\Z$, $a+c\equiv b+c\pmod  n$.</li>
        <li>Si $a\equiv b\pmod  n$ et $c\equiv d\pmod  n$ alors $a+c\equiv b+d\pmod  n$.</li>
        <li>Si $a\equiv b\pmod  n$ alors, pour tout $c\in\Z$, $ac\equiv bc\pmod  n$.</li>
        <li>Si $a\equiv b\pmod  n$ et $c\equiv d\pmod  n$ alors $ac\equiv bd\pmod  n$.</li>
        <li>Si $a\equiv b\pmod  n$ alors, pour tout $p\in\N^*$, $a^p\equiv b^p\pmod  n$.</li>
      </ol>
      <p class="muted">La division n‚Äôest <strong>pas</strong> compatible en g√©n√©ral (ex. $5\cdot    4 \equiv 5\cdot    6\pmod {10}$ mais $4 \not\equiv 6\pmod {10}$).</p>
      <details><summary>Preuve r√©dig√©e</summary>
        <p>Si $n\mid(a-b)$, alors $n\mid((a+c)-(b+c))$ (1) et, pour tout $c\in\Z$, $n\mid(ac-bc)$ (3) car $ac-bc=c(a-b)$.
        Les versions ¬´¬†mixtes¬†¬ª (2) et (4) d√©coulent en combinant (1) et (3). Enfin, $a^p-b^p=(a-b)(a^{p-1}+\cdot   s+b^{p-1})$ montre (5). L‚Äôincompatibilit√© de la division provient de ce que $n\mid ac$ et $\gcd(c,n)\ne 1$ n‚Äôimplique pas $n\mid a$.</p>
      </details>
    </details>
    <details><summary>R√©solveur lin√©aire $ax\\equiv b\\pmod{n}$</summary>
      <div class="control-row"><label class="muted" for="ma">$a$</label><input id="ma" class="input" type="number" value="3" aria-describedby="modOut"><label class="muted" for="mb">$b$</label><input id="mb" class="input" type="number" value="2" aria-describedby="modOut"><label class="muted" for="mn">$n$</label><input id="mn" class="input" type="number" value="5" aria-describedby="modOut"><button class="btn" onclick="solveMod()">R√©soudre</button></div>
      <div id="modOut" class="result" role="status" aria-live="polite"></div>
      <details><summary>Exercices types (auto‚Äëcorrection)</summary>
        <div class="step"><div class="n">1</div><div>R√©soudre $x+3 \equiv 2 \pmod {7}$. <details><summary>Correction</summary>On a $x\equiv -1 \equiv 6 \pmod {7}$.</details></div></div>
        <div class="step"><div class="n">2</div><div>R√©soudre $3x \equiv 2\pmod {5}$. <details><summary>Correction</summary>$\operatorname{pgcd}(3,5)=1$, $3\times 2\equiv 1\pmod {5}$ donc $x\equiv 4\pmod {5}$.</details></div></div>
        <div class="step"><div class="n">3</div><div>Trouver les $x$ tels que $x^2\equiv 0\pmod {4}$. <details><summary>Correction</summary>$x\equiv 0$ ou $2\pmod {4}$.</details></div></div>
      </details>
    </details>
    <details><summary>Exercice 2 ‚Äî Divisibilit√©s via congruences</summary>
      <div class="step"><div class="n">1</div><div>Montrer que pour tout $n\ge 1$, $2^{3n}-1$ est un multiple de $7$.</div></div>
      <details><summary>Correction 1</summary>
        $2^3=8\equiv 1\pmod {7}$ donc $2^{3n}=(2^3)^n\equiv 1^n\equiv 1\pmod {7}$, ainsi $2^{3n}-1\equiv 0\pmod {7}$.
      </details>
      <div class="step"><div class="n">2</div><div>D√©terminer les $n\in\N$ pour lesquels $n^2-3n+6$ est divisible par $4$.</div></div>
      <details><summary>Correction 2</summary>
        On teste $n\equiv 0,1,2,3\pmod {4}$¬†: on obtient $2,0,0,2\pmod {4}$ respectivement¬†; donc $n\equiv 1$ ou $2 \pmod {4}$.
      </details>
    </details>
    <details><summary>Exercice 3 ‚Äî Reste de 112021 modulo 3</summary>
      <div class="step"><div class="n">√ânonc√©</div><div>D√©terminer le reste de la division euclidienne de $112021$ par $3$.</div></div>
      <details><summary>Correction</summary>
        √âcrire $112021=1\times 10^5+1\times   10^4+2\times  10^3+0\times   10^2+2\times   10+1$. Or $10\equiv 1\pmod {3}$, donc $10^k\equiv 1$ pour tout $k$ et $112021\equiv 1+1+2+0+2+1=7 \equiv 1\pmod {3}$. Reste $1$.
      </details>
    </details>
  </section>

  <!-- Banque d‚Äôitems -->
  <section id="bank" class="section card">
    <h2>Banque d‚Äôitems param√©trables</h2>
    <div class="control-row">
      <label>Th√®me</label>
      <select id="bkTheme" class="input">
        <option value="div">Divisibilit√©</option>
        <option value="de">Division euclidienne</option>
        <option value="cong">Congruences</option>
        <option value="game">Jeu ‚Äî course (modulaire)</option>
        <option value="pdf">Exercices (poly)</option>
      </select>
      <label>Niveau</label>
      <select id="bkDiff" class="input">
        <option value="1">‚òÖ D√©but</option>
        <option value="2">‚òÖ‚òÖ Interm√©diaire</option>
        <option value="3">‚òÖ‚òÖ‚òÖ Avanc√©</option>
      </select>
      <button class="btn" onclick="bankNew()">G√©n√©rer</button>
      <button class="btn" onclick="bankShowSol()">Solution</button>
    </div>
    <div id="bkTask" class="result" aria-live="polite"></div>
    <div id="bkSol" class="result hidden" aria-live="polite"></div>
  </section>

  <!-- Timer -->
  <section id="timer" class="section card">
    <h2>Chronom√®tre d‚Äôactivit√©</h2>
    <div class="control-row">
      <input id="tmName" class="input" placeholder="Nom de l‚Äôactivit√© (ex. D√©fi 1 : r√©solveur modulaire)" size="36" aria-label="Nom de l‚Äôactivit√©">
      <button class="btn" onclick="tmUseBank()">‚§¥Ô∏è Nom = Banque actuelle</button>
      <button class="btn" onclick="tmStart()">‚ñ∂Ô∏è D√©marrer</button>
      <button class="btn" onclick="tmPause()">‚è∏Ô∏è Pause</button>
      <button class="btn" onclick="tmReset()">‚ü≤ R√©initialiser</button>
    </div>
    <div id="tmDisplay" class="result" role="status" aria-live="polite">00:00</div>
  </section>

  <!-- Exports -->
  <section id="exports" class="section card">
    <h2>Export des traces</h2>
    <p class="muted">Toutes les interactions (r√©ponses √©l√®ves, validations, g√©n√©rateur, r√©solutions) sont journalis√©es c√¥t√© navigateur (anonymes). Exporter au format JSON ou CSV.</p>
    <div class="control-row">
      <button class="btn" onclick="exportJSON()">üì• Export JSON</button>
      <button class="btn" onclick="exportCSV()">üì• Export CSV</button>
      <button class="btn" onclick="clearLog()">üßπ Effacer</button>
      <span id="expCount" class="pill" aria-live="polite">0 √©v√®nements</span>
    </div>
  </section>

  <!-- Python / Euclide -->
  <section id="python" class="section card">
    <h2>Encart Python ‚Äî Algorithme d‚ÄôEuclide (Pyodide)</h2>
    <p class="muted">Les sorties <code>print</code> apparaissent ci‚Äëdessous (stdout/stderr captur√©s). Saisir a et b, puis ex√©cuter.</p>
      <div class="control-row"><label class="muted" for="pyA">a</label><input id="pyA" class="input" type="number" value="114"><label class="muted" for="pyB">b</label><input id="pyB" class="input" type="number" value="8"><label class="muted" for="autoCode"><input type="checkbox" id="autoCode" checked> Remplir le code automatiquement</label></div>
    <div class="control-row" style="margin-top:6px"><button class="btn" id="loadPy">‚öôÔ∏è Charger Pyodide</button><span id="pyStatus" class="muted" aria-live="polite">non charg√©</span></div>
    <textarea id="pyCode" class="input mono" rows="10" style="width:100%;margin-top:10px" aria-label="Zone de code Python"># Saisissez a et b ci-dessus ou √©ditez ce code puis Ex√©cuter
# Exemple : a=114, b=8

def egcd(a,b):
    steps=[]
    x,y=a,b
    while y!=0:
        q=x//y; r=x%y
        steps.append((x,y,q,r))
        x,y=y,r
    return steps,x

a,b = 114,8
steps,g = egcd(a,b)
print("√âtapes (x,y,q,r):")
for s in steps:
    print(s)
print("PGCD:", g)
</textarea>
    <div class="control-row" style="margin-top:8px"><button class="btn" id="runPy" disabled>‚ñ∂Ô∏è Ex√©cuter</button><button class="btn" id="clearPy" disabled>üßπ Effacer</button></div>
    <pre id="pyOut" class="result" style="white-space:pre-wrap" aria-live="polite"></pre>
  </section>

  <!-- Auto-tests (d√©veloppeur) -->
  <section id="tests" class="section card">
    <h2>Auto‚Äëtests (d√©veloppeur)</h2>
    <details>
      <summary>V√©rifier les fonctions cl√©s</summary>
      <div class="control-row">
        <button class="btn" onclick="runTests()">‚ñ∂Ô∏è Lancer</button>
      </div>
      <pre id="testOut" class="result mono" aria-live="polite"></pre>
    </details>
  </section>

  <footer class="muted" style="margin-top:22px">¬© 2025 ‚Äî Support interactif con√ßu et r√©dig√© par <strong>Alaeddine Ben Rhouma</strong>. Tous droits r√©serv√©s.</footer>
  <div class="sticky-footer"><button class="btn" onclick="scrollTo(0,0)">‚¨ÜÔ∏è Haut</button></div>
</div>

<script>
  // ===== util =====
  const $=(q)=>document.querySelector(q), $$=(q)=>document.querySelectorAll(q);
  let log=[]; try{ const persisted=localStorage.getItem('mathsexp_log'); if(persisted){ log=JSON.parse(persisted); } }catch(e){}
  const updateExpCount=()=>{ const pill=$('#expCount'); if(pill) pill.textContent=log.length+" √©v√®nements"; };
  updateExpCount();
  const addLog=(type,payload)=>{ const evt={t:Date.now(),type,...payload}; log.push(evt); updateExpCount(); try{ localStorage.setItem('mathsexp_log', JSON.stringify(log)); }catch(e){} return evt; };
  const dl=(name,content,type)=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([content],{type})); a.download=name; a.click(); };
  const prettyT=(ms)=>{ const s=Math.floor(ms/1000), m=Math.floor(s/60), ss=(s%60+"").padStart(2,'0'); return `${m.toString().padStart(2,'0')}:${ss}`; };
  const mod=(a,n)=>((a%n)+n)%n;

  // ===== UI top =====
  // Initial theme from localStorage ou pr√©f√©rence syst√®me
  try{ const savedTheme=localStorage.getItem('theme'); if(savedTheme){ if(savedTheme==='light'){ document.body.classList.add('light'); } else { document.body.classList.remove('light'); } } else if(window.matchMedia?.('(prefers-color-scheme: light)').matches){ document.body.classList.add('light'); } }catch(e){}
  $('#themeBtn').addEventListener('click',()=>{ document.body.classList.toggle('light'); try{ localStorage.setItem('theme', document.body.classList.contains('light')?'light':'dark'); }catch(e){} MathJax.typesetPromise?.(); });
  $('#boardBtn').addEventListener('click',()=>{ document.body.classList.toggle('board'); MathJax.typesetPromise?.(); });
  $('#retypesetBtn').addEventListener('click',()=>MathJax.typesetPromise?.());
  $('#printBtn').addEventListener('click',()=>window.print());
  let revealed=false; try{ revealed=localStorage.getItem('revealed')==='1'; }catch(e){} if(revealed){ $$('details').forEach(d=>d.open=true); } $('#revealBtn').setAttribute('aria-pressed',revealed);
  $('#revealBtn').addEventListener('click',()=>{ revealed=!revealed; $$('details').forEach(d=>d.open=revealed); $('#revealBtn').setAttribute('aria-pressed',revealed); try{ localStorage.setItem('revealed', revealed?'1':'0'); }catch(e){} });
  document.addEventListener('keydown',(e)=>{ if(e.key==='?'&&!e.ctrlKey&&!e.metaKey){ alert('Raccourcis : Ctrl+B (tableau), ? (aide), Esc (replier).'); } if(e.key==='Escape'){ $$('details[open]').forEach(d=>d.open=false);} if(e.key.toLowerCase()==='b'&&(e.ctrlKey||e.metaKey)){ e.preventDefault(); $('#boardBtn').click(); }});

  // ===== quiz helpers =====
  function checkText(id,expected){ const inp=$("#"+id); const ans=(inp.value||'').trim(); const esc=(s)=>s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); let pattern = esc(expected).replace(/\s\+/g,'\\s*').replace(/√ó/g,'[√óx*]').replace(/\s/g,'\\s*').replace(/>/g,'\\s*>\\s*'); const re=new RegExp('^'+pattern+'$','i'); const ok=re.test(ans); const where=$("#"+id+"r"); if(where){ where.textContent= ok? '‚úÖ': '‚ùå'; where.className= ok? 'ok result': 'err result'; } addLog({},{area:'quiz',action:'checkText',id,ans,expected,ok}); }
  function checkSet(id,arr){ const raw=$("#"+id).value.replace(/[{}]/g,'').split(/[,;\s]+/).filter(Boolean).map(x=>parseInt(x,10)).sort((a,b)=>a-b); const exp=[...arr].sort((a,b)=>a-b); const ok = raw.length===exp.length && raw.every((v,i)=>v===exp[i]); const where=$("#"+id+"r"); where.textContent= ok? '‚úÖ': '‚ùå'; where.className= ok? 'ok result': 'err result'; addLog({},{area:'quiz',action:'checkSet',id,ans:raw,expected:exp,ok}); }
  function toggle(id){ const el=document.getElementById(id); if(!el) { addLog({},{area:'ui',action:'toggle-missing',id}); return; } el.classList.toggle('hidden'); addLog({},{area:'ui',action:'toggle',id,visible:!el.classList.contains('hidden')}); MathJax.typesetPromise?.([el]); }

  // ===== Division euclidienne outil =====
  function doDiv(){ const a=parseInt($('#dea').value,10), b=parseInt($('#deb').value,10); const out=$('#deOut'), steps=$('#deSteps'); if(!(b>0)){ out.className='result err'; out.innerHTML='Choisir $b\\in \\mathbb{N}^*$, $b\\ge 1$.'; steps.innerHTML=''; MathJax.typesetPromise?.([out]); return;} const q=Math.floor(a/b); const r=a-b*q;
    out.className='result ok'; out.innerHTML=`On obtient $q=${q}$ et $r=${r}$ avec $0\\le r<${b}$. Ainsi $${a}=${b}\\cdot   ${q}+${r}$.`;
    let x=Math.abs(a), y=Math.abs(b), trace='', i=1; while(y!==0&&i<=20){ const qq=Math.floor(x/y), rr=x%y; trace+=`<div class=\"step\"><div class=\"n\">${i}</div><div>${x} = ${y} \\cdot    ${qq} + ${rr}</div></div>`; x=y; y=rr; i++; }
    steps.innerHTML=`<details open><summary>Algorithme d‚ÄôEuclide (sur |a|,|b|)</summary>${trace}</details>`; MathJax.typesetPromise?.([out,steps]); addLog({},{area:'division',action:'doDiv',a,b,q,r}); }

  // ===== Congruences: solve ax ‚â° b [n] =====
  function egcd(a,b){ let x=1,y=0,x1=0,y1=1; while(b){ const q=Math.trunc(a/b); [a,b]=[b,a-q*b]; [x,x1]=[x1,x-q*x1]; [y,y1]=[y1,y-q*y1]; } return {g:a,x,y}; }
  function solveMod(){ const a=parseInt($('#ma').value,10), b=parseInt($('#mb').value,10), n=parseInt($('#mn').value,10); const out=$('#modOut'); if(!(n>0)){ out.className='result err'; out.innerHTML='Prendre $n\\ge 1$.'; MathJax.typesetPromise?.([out]); return;} const {g}=egcd(Math.abs(a),n); if(b%g!==0){ out.className='result err'; out.innerHTML=`Aucune solution ( $\\operatorname{pgcd}(${a},${n})=${g} \nmid ${b}$ ).`; MathJax.typesetPromise?.([out]); addLog({},{area:'congruences',action:'solveMod',a,b,n,sol:null}); return;} const a0=mod(a/g,n/g), b0=b/g, n0=n/g; const inv=mod(egcd(a0,n0).x,n0); const x0=mod(inv*b0,n0); out.className='result ok'; out.innerHTML=`Solutions : $x\\equiv ${x0}\\pmod {${n0}}$ (soit ${g} classe(s) modulo ${n}).`; MathJax.typesetPromise?.([out]); addLog({},{area:'congruences',action:'solveMod',a,b,n,sol:{x0,n0,g}}); }

  // ===== Banque d‚Äôitems =====
  function randint(a,b){ return Math.floor(Math.random()*(b-a+1))+a }
  const bank={
    div:{
      1:()=>{ const a=randint(2,10), b=randint(10,50); return {q:`Tester si $${a}\\mid${b}$`, s:()=> (b%a===0?`Oui, $${a}\\mid${b}$`:`Non, reste $${((b%a)+a)%a}$`)}; },
      2:()=>{ const n=randint(10,60), d=randint(2,10); return {q:`Montrer que $D(${d})\\subset D(${n})$`, s:()=> (n % d === 0)?`Vrai car $${d}\\mid${n}$.`:`Faux : $${d}\\nmid${n}$.`}; },
      3:()=>{ const n=randint(20,120); return {q:`Donner $D(${n})$ (tous les diviseurs).`, s:()=>`R√©ponse via factorisation des premiers.`}; }
    },
    de:{
      1:()=>{ const a=randint(30,200), b=randint(2,15); return {q:`Donner la division euclidienne de ${a} par ${b}.`, s:()=>{ const q=Math.floor(a/b), r=a-b*q; return `$${a}=${b} \cdot   ${q}+${r}$`; }}; },
      2:()=>{ const b=randint(5,12); return {q:`Combien de restes possibles modulo $${b}$ ?`, s:()=>`Il y en a ${b} : $0,1,\\dots,${b-1}$.`}; },
      3:()=>({q:`Montrer que $n^2+1$ n‚Äôest jamais multiple de 3.`, s:()=>`Classes $\\pmod {3}$: $n^2\\equiv 0$ ou $1$ ‚áí $n^2+1\\not\\equiv 0$.`})
    },
    cong:{
      1:()=>{ const n=[5,7,8,9,11][randint(0,4)], a=randint(1,n-1), b=randint(0,n-1); return {q:`R√©soudre $${a}x\\equiv${b}\\pmod {${n}}$.`, s:()=>{ const g=egcd(a,n).g; if(b%g!==0) return `Aucune solution ( $\\operatorname{pgcd}(${a},${n})=${g}\\nmid${b}$ ).`; const n0=n/g, inv=mod(egcd(a/g,n0).x,n0), x0=mod(inv*(b/g),n0); return `$x\\equiv${x0} \\pmod {${n0}}$ ( $\\operatorname{pgcd}(${a},${n})=${g}$ ).`; }}; },
      2:()=>({q:`Montrer que $11 \\equiv 7\\pmod {4}$ et expliquer pourquoi on ne peut pas ¬´ simplifier ¬ª par 5 dans $5 \\cdot    4\\equiv 5\\cdot    6\\pmod {10}$.`, s:()=>`$11\\equiv 7\\pmod {4}$ et ces deux entiers ont reste $3$ modulo $4$; la division n‚Äôest pas admissible en g√©n√©ral.`}),
      3:()=>({q:`Trouver tous les $x$ tels que $x^2\\equiv 0\\pmod 4$.`, s:()=>`$x\\equiv 0\\text{ ou }2\\pmod {4}$`})
    },
    game:{
      1:()=>({
        q:`Jeu ‚Äî course √† 20 (coups autoris√©s 1‚Äì3). Quels sont les paliers gagnants et quelle strat√©gie selon que vous commencez (J1) ou jouez en second (J2) ?`,
        s:()=>`Paliers: $4,8,12,16,20$ (multiples de $4$). Comme $20\equiv 0\pmod {4}$, J2 a une strat√©gie gagnante: r√©pondre $4-c$ √† chaque coup adverse $c\in\{1,2,3\}$. En J1, pas de coup gagnant forc√©.`
      }),
      2:()=>{ const T=randint(17,25), m=3, p=m+1, r=T%p; const paliers=Array.from({length:Math.floor(T/p)},(_,i)=>(i+1)*p).join(', ');
        return { q:`Jeu ‚Äî course √† ${T} (coups 1‚Äì${m}). D√©terminer les paliers gagnants, et le plan gagnant (J1/J2).`,
                 s:()=> r===0? `Paliers: $${paliers}$. $${T}\equiv 0 \pmod {${p}}$ ‚áí J2 gagne en r√©pondant $${p}-c$ √† chaque coup.`
                         : `Paliers: $${paliers}$. $${T}\equiv${r}\pmod {${p}}$ ‚áí J1 joue $${r}$ au premier coup puis ¬´ compl√®te √† $${p}$ ¬ª; J1 gagne.` };
      },
      3:()=>{ const m=randint(3,4), p=m+1, T=randint(p*3+2,p*5); const r=T%p; const paliers=Array.from({length:Math.floor(T/p)},(_,i)=>(i+1)*p).join(', ');
        return { q:`Jeu ‚Äî course √† ${T} (coups 1‚Äì${m}). Quels paliers gagnants et premier coup gagnant (si existant) ?`,
                 s:()=> r===0? `Paliers: $${paliers}$. $${T}\equiv 0\pmod {${p}}$ ‚áí pas de ¬´ premier coup gagnant ¬ª pour J1; J2 gagne.`
                         : `Paliers: $${paliers}$. $${T}\equiv${r}\pmod {${p}}$ ‚áí J1 joue $${r}$ puis maintient les multiples de $${p}$.` };
      }
    },
    pdf:{
      1:()=>({q:`Montrer que pour tout $n\\ge1$, $2^{3n}-1$ est multiple de $7$.`, s:()=>`$2^3\equiv 1\pmod {7}$ ‚áí $2^{3n}\equiv 1$ ‚áí $2^{3n}-1\equiv 0$.`} ),
      2:()=>({q:`D√©terminer les $n\\in\\N$ tels que $n^2-3n+6$ est divisible par 4.`, s:()=>`Tester $n\equiv 0,1,2,3\pmod {4}$ ‚áí seuls $n\equiv 1$ ou $2$ conviennent.`}),
      3:()=>{ const len=randint(5,7); const digs=Array.from({length:len},(_,i)=> (i===0? randint(1,9): randint(0,9))); const N=digs.join(''); const sum=digs.reduce((a,b)=>a+b,0); const r=sum%3; return {q:`D√©terminer le reste de $${N}$ dans la division euclidienne par 3.`, s:()=>`$10\equiv 1\pmod {3}$ ‚áí $${N}\equiv${digs.join('+')}=${sum}\equiv${r}$ (reste ${r}).`}; }
    }
  };
  let bkCurrent=null;
  function bankNew(){ const theme=$('#bkTheme').value, diff=+$('#bkDiff').value; const pool = bank[theme] ?? bank.pdf; const gen=pool[diff]||pool[1]; const item=gen(); bkCurrent={...item, theme, diff}; $('#bkTask').innerHTML=item.q; $('#bkSol').classList.add('hidden'); $('#bkSol').textContent= typeof item.s==='function'?item.s():item.s; MathJax.typesetPromise?.([$('#bkTask'),$('#bkSol')]); addLog({},{area:'bank',action:'new',theme,diff,q:bkCurrent.q}); }
  function bankShowSol(){ if(!bkCurrent) return; $('#bkSol').classList.remove('hidden'); MathJax.typesetPromise?.([$('#bkSol')]); addLog({},{area:'bank',action:'reveal',q:bkCurrent.q}); }

  // ===== Timer =====
  let t0=null, acc=0, intv=null, tmName='';
  function tick(){ $('#tmDisplay').textContent=prettyT((t0?Date.now()-t0:0)+acc); }
  function tmStart(){ if(!t0){ t0=Date.now(); intv=setInterval(tick,250); tmName=$('#tmName').value||'Activit√©'; addLog({},{area:'timer',action:'start',name:tmName}); } }
  function tmPause(){ if(t0){ acc+=Date.now()-t0; t0=null; clearInterval(intv); tick(); addLog({},{area:'timer',action:'pause',name:tmName,duration:acc}); } }
  function tmReset(){ t0=null; acc=0; clearInterval(intv); tick(); addLog({},{area:'timer',action:'reset',name:tmName}); }
  function tmUseBank(){ const t=$('#bkTask')?.textContent?.trim(); if(t){ $('#tmName').value=t.slice(0,120); }}
  tick();

  // ===== Exports =====
  function exportJSON(){ dl('traces_mathsexp.json', JSON.stringify(log,null,2), 'application/json'); }
  function exportCSV(){ if(!log.length){ dl('traces_mathsexp.csv','type,t,area,action,extra\n','text/csv'); return; } const keys=[...new Set(log.flatMap(o=>Object.keys(o)))]; const rows=[keys.join(',')].concat(log.map(o=>keys.map(k=>JSON.stringify(o[k]??'')).join(','))); dl('traces_mathsexp.csv', rows.join('\n'), 'text/csv'); }
  function clearLog(){ log.length=0; updateExpCount(); try{ localStorage.removeItem('mathsexp_log'); }catch(e){} }

  // ===== Pyodide =====
  let pyReady=false, pyodide=null; function ensurePyStdout(){ try{ if(pyodide&&pyodide.setStdout){ pyodide.setStdout({ batched:(s)=>{ const out=$('#pyOut'); out.textContent+=s; } }); pyodide.setStderr({ batched:(s)=>{ const out=$('#pyOut'); out.textContent+=s; } }); } }catch(e){} }
  $('#loadPy').addEventListener('click', async()=>{ if(pyReady) return; $('#pyStatus').textContent='chargement‚Ä¶'; const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js'; document.body.appendChild(s); await new Promise(res=>{ s.onload=res; }); // @ts-ignore
    pyodide=await loadPyodide({ indexURL:'https://cdn.jsdelivr.net/pyodide/v0.24.1/full/' }); pyReady=true; $('#pyStatus').textContent='ok'; $('#runPy').disabled=false; $('#clearPy').disabled=false; ensurePyStdout(); });
  $('#runPy').addEventListener('click', async()=>{ if(!pyReady) return; const out=$('#pyOut'); out.textContent=''; let code=$('#pyCode').value; if($('#autoCode').checked){ const a=parseInt($('#pyA').value||'114',10), b=parseInt($('#pyB').value||'8',10); code=`def egcd(a,b):\n    steps=[]\n    x,y=a,b\n    while y!=0:\n        q=x//y; r=x%y\n        steps.append((x,y,q,r))\n        x,y=y,r\n    return steps,x\n\na,b=${a},${b}\nsteps,g=egcd(a,b)\nprint('√âtapes (x,y,q,r):')\nfor s in steps:\n    print(s)\nprint('PGCD:', g)`; }
  try{ await pyodide.runPythonAsync(code); if(!out.textContent) out.textContent='(aucune sortie ‚Äî utilisez print)'; addLog({},{area:'py',action:'run',code}); } catch(e){ out.textContent='Erreur : '+e; } });
  $('#clearPy').addEventListener('click',()=>{ $('#pyOut').textContent=''; addLog({},{area:'py',action:'clear'}); });

  // ===== Auto-tests =====
  function runTests(){
    const out=$('#testOut'); const lines=[];
    try{
      // Test 1: toggle
      const tdiv=document.createElement('div'); tdiv.id='__tmpToggle'; tdiv.className='result hidden'; document.body.appendChild(tdiv);
      const beforeHidden=tdiv.classList.contains('hidden'); toggle('__tmpToggle'); const afterFirst=!tdiv.classList.contains('hidden'); toggle('__tmpToggle'); const afterSecond=tdiv.classList.contains('hidden');
      lines.push(`Test toggle: beforeHidden=${beforeHidden}, afterFirstVisible=${afterFirst}, afterSecondHidden=${afterSecond} ‚Üí ${(beforeHidden&&afterFirst&&afterSecond)?'OK':'FAIL'}`);
      tdiv.remove();

      // Test 2: Euclide shows \cdot   
      const dea=$('#dea'), deb=$('#deb'); const oldA=dea.value, oldB=deb.value; dea.value=114; deb.value=8; doDiv(); const hasDot=$('#deSteps').innerHTML.includes('\cdot   ') || $('#deSteps').innerHTML.includes('cdot');
      lines.push(`Test Euclide (\cdot    rendu): ${hasDot?'OK':'FAIL'}`); dea.value=oldA; deb.value=oldB;

      // Test 3: tolerant matcher for 24 = -4 √ó -6
      const expected='24 = -4√ó-6'; const esc=(s)=>s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); const re=new RegExp('^'+esc(expected).replace(/\s\+/g,'\\s*').replace(/√ó/g,'[√óx*]').replace(/\s/g,'\\s*').replace(/>/g,'\\s*>\\s*')+'$','i');
      const samples=['24=-4x-6','24 = -4 * -6','24 = -4√ó-6','24= -4  √ó  -6'];
      const okAll=samples.every(s=>re.test(s));
      lines.push(`Test formats tol√©rants: ${okAll?'OK':'FAIL'}`);

      // Test 4: solver mod ‚Äî example 3x ‚â° 2 [5]
      $('#ma').value=3; $('#mb').value=2; $('#mn').value=5; solveMod(); const modOk=$('#modOut').textContent.includes('x') && $('#modOut').textContent.match(/4\b/);
      lines.push(`Test solveMod (3x‚â°2[5]): ${modOk?'OK':'FAIL'}`);
    } catch(e){ lines.push('Erreur tests: '+e); }
    out.textContent=lines.join('\n');
  }
</script>
</body>
</html>
